<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .user-list {
            margin-top: 20px;
        }
        .user-item {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
        }
        .user-item input {
            width: 100px;
            padding: 5px;
        }
    </style>
</head>
<body>

<h2>Admin Panel - User Management</h2>

<!-- List of users and their balances will appear here -->
<div class="user-list" id="user-list"></div>

<!-- Add Firebase Script -->
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
    import { getFirestore, collection, getDocs, doc, updateDoc } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

    // Firebase config (replace with your own config)
    const firebaseConfig = {
        apiKey: "AIzaSyAN0MfvvHmznveLEoIV8vLNorRO6F2VAs0",
        authDomain: "cashdeals-185df.firebaseapp.com",
        projectId: "cashdeals-185df",
        storageBucket: "cashdeals-185df.appspot.com",
        messagingSenderId: "749879075742",
        appId: "1:749879075742:web:a82980caf53bef5c9aac8f"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Function to load users from Firestore and display them
    async function loadUsers() {
        const userListContainer = document.getElementById("user-list");
        const querySnapshot = await getDocs(collection(db, "clients"));

        // Clear the user list before displaying new users
        userListContainer.innerHTML = '';

        querySnapshot.forEach(doc => {
            const user = doc.data();
            const userItem = document.createElement("div");
            userItem.classList.add("user-item");

            // Display user info (email, username, balance)
            userItem.innerHTML = `
                <span>${user.username} (${user.email}) - Balance: $<span id="balance-${user.uid}">${user.balance}</span></span>
                <input type="number" id="new-balance-${user.uid}" value="${user.balance}" />
                <button onclick="updateBalance('${user.uid}')">Update Balance</button>
            `;
            userListContainer.appendChild(userItem);
        });
    }

    // Function to update the balance in Firestore
    async function updateBalance(userId) {
        const newBalance = document.getElementById(`new-balance-${userId}`).value;
        const balanceRef = doc(db, "clients", userId);

        try {
            await updateDoc(balanceRef, {
                balance: parseFloat(newBalance)
            });
            alert("Balance updated successfully!");
            loadUsers();  // Refresh the user list to show updated balance
        } catch (error) {
            alert("Error updating balance: " + error.message);
        }
    }

    // Load users on page load
    window.onload = loadUsers;
</script>

</body>
</html>
